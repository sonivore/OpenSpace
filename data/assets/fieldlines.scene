local assetHelper = asset.require('util/asset_helper')
local sceneHelper = asset.require('util/scene_helper')
local propertyHelper = asset.require('util/property_helper')

-- Specifying which other assets should be loaded in this scene
asset.require('spice/base')
assetHelper.requestAll(asset, 'scene/solarsystem/sun')
asset.require('scene/solarsystem/planets')
asset.require('scene/digitaluniverse/stars')

-- Load default key bindings applicable to most scenes
asset.require('util/default_keybindings')
asset.require('util/default_dashboard')
asset.request('customization/globebrowsing')

asset.require('scene/solarsystem/sun/sun')

-- We need to specify paths to the prepared fieldline files before requesting the BATSRUS, ENLIL, and PFSS fieldline assets:
-- local FieldLineBasePath = "C:/Users/CCMC/data/fieldlines_binaries/"
-- ENLILPaths = {
--     EqPlane011AU1 = FieldLineBasePath .. "enlil/july2012/downsampled40/011AU_eq_plane_1/",
--     EqPlane011AU2 = FieldLineBasePath .. "enlil/july2012/downsampled40/011AU_eq_plane_2/",
--     Lat4011AU1 = FieldLineBasePath .. "enlil/july2012/downsampled40/011AU_lat4_1/",
--     Lat4011AU2 = FieldLineBasePath .. "enlil/july2012/downsampled40/011AU_lat4_2/",
--     Earth = FieldLineBasePath .. "enlil/july2012/downsampled40/earth/",
--     StereoA = FieldLineBasePath .. "enlil/july2012/downsampled40/stereoa/"
-- }
-- asset.require('./fieldlines/enlil')

MASPaths = {
    Sun = "E:/MAS_Bastille/fieldlines/osfls"
}
asset.require('./fieldlines/mas')

-- Keybindings that are specific for this scene
local Keybindings = {
    {
        Key = "F1",
        Command =
[[local b = openspace.getPropertyValue('Modules.ImGUI.Main.Enabled');
openspace.setPropertyValueSingle('Modules.ImGUI.Main.Enabled', not b);
openspace.setPropertyValueSingle('Modules.ImGUI.Main.IsHidden', b);]],
        Documentation = "Shows or hides the entire user interface",
        Local = true
    },
    {
        Key = "F5",
        Command = "openspace.time.setTime('2000 JUL 14 08:33:37.100');",
        Documentation = "Jumps to first of the MAS-fieldline timesteps",
        Local = true
    },
    {
        Key = "F6",
        Command = "openspace.time.setTime('2012 JUL 01 00:07:00.000');",
        Documentation = "Jumps to first of the Enlil-fieldline timesteps",
        Local = true
    },
    {
        Key = "F8",
        Command = propertyHelper.invert('Scene.SunGlare.renderable.Enabled'),
        Documentation = "Toggles the Sun glare",
        Local = true
    },
}


local earthAsset = asset.require('scene/solarsystem/planets/earth/earth')
local sunAsset = asset.require('scene/solarsystem/sun/sun')

local sunRadius = 695508000


asset.onInitialize(function ()

    openspace.time.setTime("2000 JUL 14 08:33:37.100")
    openspace.setPropertyValue('Scene.SunGlare.renderable.Enabled', false)

    sceneHelper.bindKeys(Keybindings)
    openspace.setDefaultGuiSorting()

    openspace.globebrowsing.loadWMSServersFromFile(
        openspace.absPath("${DATA}/globebrowsing_servers.lua")
    )

    openspace.markInterestingNodes({
        "Earth", "Sun", "Moon", "FL_ENLIL_earth", "FL_MAS"
    })

    openspace.navigation.setCameraState({
        Focus = sunAsset.Sun.Identifier,
        Position = { 80*sunRadius, 80*sunRadius, 0 },
        Rotation = { 0.0, 0.0, 0.7, 0.0 },
    })

    -- openspace.globebrowsing.goToGeo(58.5877, 16.1924, 20000000)
end)

asset.onDeinitialize(function ()
    sceneHelper.unbindKeys(Keybindings)

    openspace.removeVirtualProperty("*Trail.renderable.Enabled")

    openspace.removeInterestingNodes({
        "Earth", "Mars", "Moon", "FL_ENLIL_earth", "FL_MAS"
    })
end)
